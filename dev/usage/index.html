<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example Usage · BifrostTools.jl</title><meta name="title" content="Example Usage · BifrostTools.jl"/><meta property="og:title" content="Example Usage · BifrostTools.jl"/><meta property="twitter:title" content="Example Usage · BifrostTools.jl"/><meta name="description" content="Documentation for BifrostTools.jl."/><meta property="og:description" content="Documentation for BifrostTools.jl."/><meta property="twitter:description" content="Documentation for BifrostTools.jl."/><meta property="og:url" content="https://ITA-Solar.github.io/BifrostTools.jl/usage/"/><meta property="twitter:url" content="https://ITA-Solar.github.io/BifrostTools.jl/usage/"/><link rel="canonical" href="https://ITA-Solar.github.io/BifrostTools.jl/usage/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BifrostTools.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../install/">Installation</a></li><li class="is-active"><a class="tocitem" href>Example Usage</a><ul class="internal"><li><a class="tocitem" href="#Using-BifrostExperiment"><span>Using <code>BifrostExperiment</code></span></a></li><li><a class="tocitem" href="#Reading-data-from-the-simulation-with-get_var"><span>Reading data from the simulation with <code>get_var</code></span></a></li><li><a class="tocitem" href="#Loading-the-simulation-parameters-with-read_params"><span>Loading the simulation parameters with <code>read_params</code></span></a></li></ul></li><li><a class="tocitem" href="../documentation/">Documentation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Example Usage</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Example Usage</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ITA-Solar/BifrostTools.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ITA-Solar/BifrostTools.jl/blob/develop-documentation/docs/src/usage.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Example-usage"><a class="docs-heading-anchor" href="#Example-usage">Example usage</a><a id="Example-usage-1"></a><a class="docs-heading-anchor-permalink" href="#Example-usage" title="Permalink"></a></h1><p>To load the package, type the following in the REPL</p><pre><code class="language- hljs">using BifrostTools</code></pre><h2 id="Using-BifrostExperiment"><a class="docs-heading-anchor" href="#Using-BifrostExperiment">Using <code>BifrostExperiment</code></a><a id="Using-BifrostExperiment-1"></a><a class="docs-heading-anchor-permalink" href="#Using-BifrostExperiment" title="Permalink"></a></h2><p>In this example, we look at the simulation <em>cb24oi</em>. we start with defining the part to the simulation directory and the name of the simulation.</p><pre><code class="language- hljs">expdir = &quot;/mn/stornext/d21/RoCS/matsc/3d/run/cb24oi/&quot;
expname = &quot;cb24oi&quot;</code></pre><p>These variables can be passed to the <code>BifrostExperiment</code> structure, which creates an instance that lets us access the mesh file, snapshot numbers, and so on.</p><pre><code class="language- hljs">xp = BifrostExperiment(expname,expdir)

# Mesh file that holds grid info etc.
mesh = xp.mesh

x = mesh.x
y = mesh.y
z = mesh.z

# vector with snap numbers
snaps = xp.snaps</code></pre><h2 id="Reading-data-from-the-simulation-with-get_var"><a class="docs-heading-anchor" href="#Reading-data-from-the-simulation-with-get_var">Reading data from the simulation with <code>get_var</code></a><a id="Reading-data-from-the-simulation-with-get_var-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-data-from-the-simulation-with-get_var" title="Permalink"></a></h2><p>Reading data from the snapshot or aux files is handled through the <code>get_var</code> function. Due to <code>Julia</code>&#39;s multiple dispatch functionality, there are several ways to call the <code>get_var</code> function, but we recommend using the following function to simplify the calling signature:</p><pre><code class="language- hljs">get_var(
    xp::BifrostExperiment,
    snap::Union{&lt;:Integer, AbstractVector{&lt;:Integer}},
    variable::String,
    args...
    ;
    kwargs...
)</code></pre><p>This funciton loads a <em>variable</em> from one or multiple snapshots of <code>xp</code>. If multiple snapshots are loaded, the variable is returned as a <code>Vector</code> of snapshots. The available variables are</p><p>The primary variables:</p><ul><li>&quot;r&quot;:  density</li><li>&quot;px&quot;: x-component of momentum</li><li>&quot;py&quot;: y-component of momentum</li><li>&quot;pz&quot;: z-component of momentum</li><li>&quot;e&quot;:  energy</li></ul><p>if <code>params[&quot;do_mhd&quot;]</code> is <code>true</code> in the params file, we also have the magnetic field:</p><ul><li>&quot;bx&quot;: x-component of magnetic field</li><li>&quot;by&quot;: y-component of magnetic field</li><li>&quot;bz&quot;: z-component of magnetic field</li></ul><p>and auxilliary variables (variables in params[&quot;aux&quot;]):</p><ul><li>&quot;p&quot;: pressure</li><li>&quot;tg&quot;: gas temperature</li><li>Q terms</li></ul><p>The following are optional keyword-arguments</p><ul><li><code>units::String</code>: Converts variables to &quot;si&quot; or &quot;cgs&quot; units. <code>units=&quot;si&quot;</code> or <code>units=&quot;cgs&quot;</code>.</li><li><code>destagger::Bool</code>: Performs 5th-order interpolation to center the variable, and should only be used when reading variables that are staggered, (e.g. velocity or magnetic field). The function uses the default direction (destaggeroperation) associated with the variable unless otherwise stated by the <code>destaggeroperation</code> keyword.</li><li><code>destaggeroperation::String</code>: Determines which direction to destagger the variable. This is by default handled automatically by the <code>destaggeroperation</code> dictionary. </li><li><code>rotate_about_x::String</code>: Rotate coordinate system to the normal &quot;right hand system&quot; with <em>z</em>-axis pointing upwards by passing <code>rotate_about=&quot;x&quot;</code></li><li><code>slicex::AbstractVector{&lt;:Integer}</code>: Load a slice or slices in x-axis. Give e.g. <code>slicex=[32, 410]</code> or <code>slicex=40:90</code></li><li><code>slicey::AbstractVector{&lt;:Integer}</code>: Load a slice or slices in y-axis</li><li><code>slicez::AbstractVector{&lt;:Integer}</code>: Load a slice or slices in z-axis</li><li><code>squeeze::Bool</code>: Removes singleton dimensions (dimensions with length 1)</li></ul><h3 id="Loading-a-single-snapshot"><a class="docs-heading-anchor" href="#Loading-a-single-snapshot">Loading a single snapshot</a><a id="Loading-a-single-snapshot-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-a-single-snapshot" title="Permalink"></a></h3><p>With <code>xp</code> as defined above, we define a snapshot that we want to investigate. When loading the full cube in code units, the variables are memory mapped, making them fast to load.</p><pre><code class="language- hljs">snap = 700
# Load some quantities for the full cube in code units
pressure = get_var(xp, snap, &quot;p&quot;)
density = get_var(xp, snap, &quot;r&quot;)
temperature = get_var(xp, snap, &quot;tg&quot;)</code></pre><h3 id="Converting-units"><a class="docs-heading-anchor" href="#Converting-units">Converting units</a><a id="Converting-units-1"></a><a class="docs-heading-anchor-permalink" href="#Converting-units" title="Permalink"></a></h3><p>If we want <em>si</em> or <em>cgs</em> units:</p><pre><code class="language- hljs">snap = 700
# Load some quantities for the full cube in si or cgs units
pressure = get_var(xp, snap, &quot;p&quot;, units=&quot;cgs&quot;)
rho = get_var(xp, snap, &quot;r&quot;, units=&quot;si&quot;)
# The temperature is written in Kelvin from before
temperature = get_var(xp, snap, &quot;tg&quot;)</code></pre><h3 id="Reading-a-slice-of-the-full-cube"><a class="docs-heading-anchor" href="#Reading-a-slice-of-the-full-cube">Reading a slice of the full cube</a><a id="Reading-a-slice-of-the-full-cube-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-a-slice-of-the-full-cube" title="Permalink"></a></h3><p>If we&#39;re only interested in a small part of the cube, we can use the slicing functionality of <code>get_var</code>. Use the <code>squeeze</code> keyword to drop singleton dimensions.</p><p>We can load only the surface</p><pre><code class="language- hljs">idz = argmin(abs.(mesh.z))

rho = get_var(xp, snap, &quot;r&quot;; units=&quot;si&quot;, slicez=[idz], squeeze=true)
temperature = get_var(xp, snap, &quot;tg&quot;; units=&quot;si&quot;, slicez=[idz], squeeze=true)</code></pre><p>or a smaller cube around the surface</p><pre><code class="language- hljs">rho = get_var(xp, snap, &quot;r&quot;,
     units=&quot;si&quot;, slicex=100:200, slicey=400:500, slicez=[idz-20:idz+20])
temperature = get_var(xp, snap, &quot;tg&quot;,
     units=&quot;si&quot;, slicex=100:200, slicey=400:500, slicez=[idz-20:idz+20])</code></pre><h3 id="Interpolating-staggered-variables-to-the-grid-center"><a class="docs-heading-anchor" href="#Interpolating-staggered-variables-to-the-grid-center">Interpolating staggered variables to the grid center</a><a id="Interpolating-staggered-variables-to-the-grid-center-1"></a><a class="docs-heading-anchor-permalink" href="#Interpolating-staggered-variables-to-the-grid-center" title="Permalink"></a></h3><p>Interpolating staggered variables (destaggering) can be handled through <code>get_var</code>. This is recommended because <code>get_var</code> can determine the interpolation direction, and if you want to slice a variable, it takes care of the correct ordering of interpolating and slicing. </p><pre><code class="language- hljs"># Read and destagger vertical momentum in si units
pz = get_var(xp, snap, &quot;pz&quot;, units=&quot;si&quot;, destagger=true)</code></pre><h3 id="Reading-multiple-snapshots"><a class="docs-heading-anchor" href="#Reading-multiple-snapshots">Reading multiple snapshots</a><a id="Reading-multiple-snapshots-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-multiple-snapshots" title="Permalink"></a></h3><p>If you want the time evolution </p><p>If you want to get the time evolution of a quantity, you can simply pass a vector of snapshots. The <code>get_var</code> function uses Julia&#39;s threads functionality to read multiple snapshots in parallel. </p><pre><code class="language- hljs">snaps = 100:150

rho = get_var(xp, snaps, &quot;r&quot;, units=&quot;si&quot;, slicez=[idz], squeeze=true)
# Calculate vertical velocity
vz = get_var(xp, snaps, &quot;pz&quot;, units=&quot;si&quot;, slicez=[idz], squeeze=true) ./ rho</code></pre><h3 id="Rotating-grid"><a class="docs-heading-anchor" href="#Rotating-grid">Rotating grid</a><a id="Rotating-grid-1"></a><a class="docs-heading-anchor-permalink" href="#Rotating-grid" title="Permalink"></a></h3><p>Rotate about the x-axis to get vector quantities on a <em>z</em>-axis that points upwards.</p><pre><code class="nohighlight hljs"># When we rotate about the x-axis, this is what happens to the grid
z = -mesh.z
y = -mesh.y

# Load x-component of B-field and rotate about x-axis
bx = get_var(xp, isnap, &quot;bx&quot;, units=&quot;si&quot;, destagger=true, rotate_about=&quot;x&quot;)</code></pre><h2 id="Loading-the-simulation-parameters-with-read_params"><a class="docs-heading-anchor" href="#Loading-the-simulation-parameters-with-read_params">Loading the simulation parameters with <code>read_params</code></a><a id="Loading-the-simulation-parameters-with-read_params-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-the-simulation-parameters-with-read_params" title="Permalink"></a></h2><p>The <code>read_params</code> function reads the params file. It can be called by giving the full filename, like the following</p><pre><code class="language- hljs">snap = 500
params_file = joinpath(expdir,string(expname,&quot;_&quot;,snap,&quot;.idl&quot;))
params = read_params(params_file)</code></pre><p>or</p><pre><code class="language- hljs">read_params(expname,snap,expdir)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../install/">« Installation</a><a class="docs-footer-nextpage" href="../documentation/">Documentation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Thursday 21 March 2024 10:13">Thursday 21 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
