<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://ita-solar.github.io/BifrostTools/usage/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Example usage - BifrostTools documentation</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">BifrostTools documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">BifrostTools</a>
                            </li>
                            <li class="navitem">
                                <a href="../install/" class="nav-link">Installation</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Example usage</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../install/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/ITA-Solar/BifrostTools.jl/" class="nav-link">ita-solar/BifrostTools.jl</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#example-usage" class="nav-link">Example usage</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#using-bifrostexperiment" class="nav-link">Using BifrostExperiment</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#reading-data-from-the-simulation-with-get_var" class="nav-link">Reading data from the simulation with get_var</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#loading-the-simulation-parameters-with-read_params" class="nav-link">Loading the simulation parameters with read_params</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="example-usage">Example usage</h1>
<p>To load the package, type the following in the REPL</p>
<pre><code>using BifrostTools
</code></pre>
<h2 id="using-bifrostexperiment">Using <code>BifrostExperiment</code></h2>
<p>In this example, we look at the simulation <em>cb24oi</em>.
we start with defining the part to the simulation directory and the name of the simulation.</p>
<pre><code>expdir = &quot;/mn/stornext/d21/RoCS/matsc/3d/run/cb24oi/&quot;
expname = &quot;cb24oi&quot;
</code></pre>
<p>These variables can be passed to the <code>BifrostExperiment</code> structure, which creates an instance that lets us access the mesh file, snapshot numbers, and so on.</p>
<pre><code>xp = BifrostExperiment(expname,expdir)

# Mesh file that holds grid info etc.
mesh = xp.mesh

x = mesh.x
y = mesh.y
z = mesh.z

# vector with snap numbers
snaps = xp.snaps
</code></pre>
<h2 id="reading-data-from-the-simulation-with-get_var">Reading data from the simulation with <code>get_var</code></h2>
<p>Reading data from the snapshot or aux files is handled through the <code>get_var</code> function. Due to <code>Julia</code>'s multiple dispatch functionality, there are several ways to call the <code>get_var</code> function, but we recommend using the following function to simplify the calling signature:</p>
<pre><code>get_var(
    xp::BifrostExperiment,
    snap::Union{&lt;:Integer, AbstractVector{&lt;:Integer}},
    variable::String,
    args...
    ;
    kwargs...
)
</code></pre>
<p>This funciton loads a <em>variable</em> from one or multiple snapshots of <code>xp</code>. The available variables are</p>
<p>The primary variables:
- "r":  density
- "px": x-component of momentum
- "py": y-component of momentum
- "pz": z-component of momentum
- "e":  energy</p>
<p><code>if params["do_mhd"] == true</code>
- "bx": x-component of magnetic field
- "by": y-component of magnetic field
- "bz": z-component of magnetic field</p>
<p>and auxilliary variables (variables in params["aux"]):
- "p": pressure
- "tg": gas temperature
- Q terms</p>
<p>The following are optional keyword-arguments
- <code>units::String</code>: Converts variables to "si" or "cgs" units. <code>units="si"</code> or <code>units="cgs"</code>.
- <code>destagger::Bool</code>: Performs 5th-order interpolation to center the variable, and should only be used when reading variables that are staggered, (e.g. velocity or magnetic field). The function uses the default direction (destaggeroperation) associated with the variable unless otherwise stated by the <code>destaggeroperation</code> keyword.
- <code>destaggeroperation::String</code>: Determines which direction to destagger the variable. This is by default handled automatically by the <code>destaggeroperation</code> dictionary. 
- <code>rotate_about_x::String</code>: Rotate coordinate system to the normal "right hand system" with <em>z</em>-axis pointing upwards by passing <code>rotate_about="x"</code>
- <code>slicex::AbstractVector{&lt;:Integer}=Int[]</code>: Load a slice or slices in x-axis. Give e.g. <code>slicex=[32, 410]</code> or <code>slicex=40:90</code>
- <code>slicey::AbstractVector{&lt;:Integer}=Int[]</code>: Load a slice or slices in y-axis
- <code>slicez::AbstractVector{&lt;:Integer}=Int[]</code>: Load a slice or slices in z-axis</p>
<pre><code>exp_name = &quot;cb24oi&quot;
exp_dir = &quot;/mn/stornext/d21/RoCS/matsc/3d/run/cb24oi&quot;
snap = 700

xp = BifrostExperiment(expname, expdir)

# Load pressude for the full cube in si units
pressure = get_var(xp, snap, &quot;p&quot;; units=&quot;si&quot;)

# Load gas density in a slize along the xy-plane in cgs units
rho = get_var(xp, snap, &quot;r&quot;; units=&quot;cgs&quot;, slicez=[100])
# Then read and destagger vertical velocity
vz = get_var(xp, isnap, &quot;pz&quot;, units=&quot;si&quot;, destagger=true, slicez=[100]) ./ rho

# Load x-component of B-field and rotate about x-axis
bx = get_var(xp, isnap, &quot;bx&quot;, units=&quot;si&quot;, destagger=true, rotate_about=&quot;x&quot;)
</code></pre>
<h2 id="loading-the-simulation-parameters-with-read_params">Loading the simulation parameters with <code>read_params</code></h2>
<p>The <code>read_params</code> function reads the params file. It can be called by giving the full filename, like the following</p>
<pre><code>snap = 500
params_file = joinpath(expdir,string(expname,&quot;_&quot;,snap,&quot;.idl&quot;))
params = read_params(params_file)
</code></pre>
<p>or</p>
<pre><code>read_params(expname,snap,expdir)
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
